@startuml Berlin-Group-MCP-Search-Endpoints-Sequence
title Berlin Group MCP Server - Search Endpoints Functionality Sequence

actor "User/Client" as Client
participant "MCP Server\n(Tool Handler)" as Server
participant "Tool Router" as Router
participant "SpecificationIndexer" as Indexer
participant "YamlParser" as YamlParser
database "Endpoints Index" as Index

Client -[#0277BD]> Server: callTool("search_endpoints", {query: "accounts"})
activate Server
note right of Server: Receive search_endpoints tool call

Server -[#0277BD]> Router: route_tool_call(search_endpoints)
activate Router

Router -[#0277BD]> Indexer: searchEndpoints(query)
activate Indexer

Indexer -[#388E3C]> YamlParser: searchEndpoints(query)
activate YamlParser

YamlParser -[#388E3C]> Index: get all endpoints
Index --[#388E3C]> YamlParser: endpoints array

YamlParser -[#388E3C]> YamlParser: filter_endpoints()
note right of YamlParser
    Filter by:
    - path contains query
    - operationId contains query
    - summary contains query
    - description contains query
    - tags contain query
end note

YamlParser -[#388E3C]> YamlParser: build_results()
note right of YamlParser
    For each matched endpoint:
    - Include path
    - Include method
    - Include operationId
    - Include summary
    - Include description
    - Include tags
    - Include specFile
end note

YamlParser --[#388E3C]> Indexer: filtered EndpointInfo[]
deactivate YamlParser

Indexer --[#0277BD]> Router: search results
deactivate Indexer

Router -[#0277BD]> Router: format_response()
note right of Router
    Structure response:
    {
        endpoints: [{
            path: string,
            method: string,
            operationId?: string,
            summary?: string,
            tags?: string[],
            specFile: string
        }]
    }
end note

Router --[#0277BD]> Server: formatted results
deactivate Router

Server -[#0277BD]> Server: create_json_rpc_response()
note right of Server
    {
        jsonrpc: "2.0",
        id: request_id,
        result: {
            endpoints: [...]
        }
    }
end note

Server --[#0277BD]> Client: JSON-RPC Response
deactivate Server

Client -[#1976D2]> Client: process results
note right of Client
    Display/process:
    - List of matching endpoints
    - API methods
    - Associated specs
    - Available for further queries
end note

@enduml